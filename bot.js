const TelegramBot = require('node-telegram-bot-api');
const express = require('express');
const app = express();

// Ð¢Ð¾ÐºÐµÐ½ Ð±ÑƒÐ´ÐµÑ‚ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½ Ñ‡ÐµÑ€ÐµÐ· Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ
const token = process.env.BOT_TOKEN;
const bot = new TelegramBot(token, {polling: true});

// Ð‘Ð°Ð·Ð° Ð·Ð½Ð°Ð½Ð¸Ð¹
const knowledgeBase = {
  "Ð¿Ð»Ð¾Ñ‰Ð°Ð´ÑŒ": "ðŸ­ ELP â€” Ð»Ð¾Ð³Ð¸ÑÑ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð¿Ð°Ñ€Ðº ÐºÐ»Ð°ÑÑÐ° Ð Ð¾Ð±Ñ‰ÐµÐ¹ Ð¿Ð»Ð¾Ñ‰Ð°Ð´ÑŒÑŽ 250 000 ÐºÐ². Ð¼.\n\nâ€¢ ÐšÐ¾Ñ€Ð¿ÑƒÑ Ð: 32 800 Ð¼Â²\nâ€¢ ÐšÐ¾Ñ€Ð¿ÑƒÑ Ð’: 17 500 Ð¼Â²\nâ€¢ ÐœÐ¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ð°Ñ Ð°Ñ€ÐµÐ½Ð´Ð°: Ð¾Ñ‚ 3 500 Ð¼Â²",
  "ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ": "ðŸ’° ÐžÑ‚ 5 500 â‚¸/Ð¼Â² Ñ OPEX\nâ€¢ Ð’ÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚ ÑÐºÑÐ¿Ð»ÑƒÐ°Ñ‚Ð°Ñ†Ð¸Ð¾Ð½Ð½Ñ‹Ðµ Ñ€Ð°ÑÑ…Ð¾Ð´Ñ‹\nâ€¢ Ð˜Ð½Ð´Ð¸Ð²Ð¸Ð´ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ñ€Ð°ÑÑ‡ÐµÑ‚ Ñƒ Ð±Ñ€Ð¾ÐºÐµÑ€Ð°",
  "Ñ€Ð°ÑÐ¿Ð¾Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ": "ðŸ“ ÐšÑƒÐ»ÑŒÐ´Ð¶Ð¸Ð½ÑÐºÐ¸Ð¹ Ñ‚Ñ€Ð°ÐºÑ‚, 200 (Ð¢Ð°Ð»Ð³Ð°Ñ€ÑÐºÐ¸Ð¹ Ñ€-Ð½)\nâ€¢ 30 ÐºÐ¼ Ð´Ð¾ ÐÐ»Ð¼Ð°Ñ‚Ñ‹\nâ€¢ 22 ÐºÐ¼ Ð´Ð¾ Ð°ÑÑ€Ð¾Ð¿Ð¾Ñ€Ñ‚Ð°\nâ€¢ 5 ÐºÐ¼ Ð´Ð¾ Ð‘ÐÐšÐÐ”\nâ€¢ ÐšÐ¾Ð¾Ñ€Ð´Ð¸Ð½Ð°Ñ‚Ñ‹: 43.394771, 77.173137",
  "ÑÑ€Ð¾Ðº": "ðŸ“… ÐŸÑ€Ð¾ÐµÐºÑ‚: 2025-2028 Ð³Ð³.\nâ€¢ 1 ÑÑ‚Ð°Ð¿ (ÐšÐ¾Ñ€Ð¿ÑƒÑ Ð’) â€” ÑÐ´Ð°Ð½\nâ€¢ ÐŸÐ¾ÑÑ‚Ð°Ð¿Ð½Ñ‹Ð¹ Ð²Ð²Ð¾Ð´ Ð´Ð¾ 250 000 Ð¼Â²",
  "Ð±Ñ€Ð¾ÐºÐµÑ€": "ðŸ¤ Ð­ÐºÑÐºÐ»ÑŽÐ·Ð¸Ð²Ð½Ñ‹Ð¹ Ð±Ñ€Ð¾ÐºÐµÑ€: Bright Rich | CORFAC International\nâ€¢ Ð¢ÐžÐŸ-5 Ð½Ð° Ñ€Ñ‹Ð½ÐºÐµ Ð½ÐµÐ´Ð²Ð¸Ð¶Ð¸Ð¼Ð¾ÑÑ‚Ð¸ Ð Ðš\nâ€¢ 16 Ð»ÐµÑ‚ Ð¾Ð¿Ñ‹Ñ‚Ð°, 3 Ð¼Ð»Ð½ Ð¼Â² ÑÐ´ÐµÐ»Ð¾Ðº",
  "Ñ…Ð°Ñ€Ð°ÐºÑ‚ÐµÑ€Ð¸ÑÑ‚Ð¸ÐºÐ¸": "âš™ï¸ ÐšÐ»Ð°ÑÑ Ð:\nâ€¢ Ð’Ñ‹ÑÐ¾Ñ‚Ð°: 12 Ð¼\nâ€¢ ÐÐ°Ð³Ñ€ÑƒÐ·ÐºÐ°: 8 Ñ‚/Ð¼Â²\nâ€¢ ÐšÐ¾Ð»Ð¾Ð½Ð½Ñ‹: 12Ã—24 Ð¼\nâ€¢ Ð”Ð¾ÐºÐ¸: 1 Ð½Ð° 1200 Ð¼Â²\nâ€¢ ÐŸÐ¾Ð¶Ð°Ñ€Ð½Ð°Ñ ÑÐ¸ÑÑ‚ÐµÐ¼Ð°: 0,9 Ð»/Ñ Ð½Ð° Ð¼Â²",
  "Ð¸Ð½Ñ„Ñ€Ð°ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð°": "ðŸ¢ 3 ÐÐ‘Ð§ Ð¿Ð¾ 1 128 Ð¼Â²\nâ€¢ Ð”Ð¾ 320 ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ¾Ð²\nâ€¢ 16 ÑÐ°Ð½ÑƒÐ·Ð»Ð¾Ð², 4 Ð´ÑƒÑˆÐ°\nâ€¢ 50 Ð¼ÐµÑÑ‚ Ð´Ð»Ñ Ñ„ÑƒÑ€, 32 Ð´Ð»Ñ Ð»ÐµÐ³ÐºÐ¾Ð²Ñ‹Ñ…",
  "Ð´ÐµÐ²ÐµÐ»Ð¾Ð¿ÐµÑ€": "ðŸ—ï¸ ÐžÐ¿Ñ‹Ñ‚Ð½Ñ‹Ð¹ Ð´ÐµÐ²ÐµÐ»Ð¾Ð¿ÐµÑ€\nâ€¢ ÐŸÑ€Ð¾ÐµÐºÑ‚Ñ‹ Ð² ÐœÐ¾ÑÐºÐ²Ðµ Ð¸ ÐšÐ°Ð·Ð°Ð½Ð¸\nâ€¢ Ð›Ð°ÑƒÑ€ÐµÐ°Ñ‚ CRE Awards 2023"
};

// ÐšÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€Ð°
function createKeyboard() {
  return {
    keyboard: [
      [{text: "ðŸ“ ÐŸÐ»Ð¾Ñ‰Ð°Ð´Ð¸"}, {text: "ðŸ’° Ð¡Ñ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ"}],
      [{text: "ðŸ“ Ð Ð°ÑÐ¿Ð¾Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ"}, {text: "âš™ï¸ Ð¥Ð°Ñ€Ð°ÐºÑ‚ÐµÑ€Ð¸ÑÑ‚Ð¸ÐºÐ¸"}],
      [{text: "ðŸ¤ Ð‘Ñ€Ð¾ÐºÐµÑ€"}, {text: "ðŸ“… Ð¡Ñ€Ð¾ÐºÐ¸"}],
      [{text: "ðŸ¢ Ð˜Ð½Ñ„Ñ€Ð°ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð°"}, {text: "ðŸ—ï¸ Ð”ÐµÐ²ÐµÐ»Ð¾Ð¿ÐµÑ€"}]
    ],
    resize_keyboard: true,
    one_time_keyboard: false
  };
}

// ÐšÐ¾Ð¼Ð°Ð½Ð´Ð° /start
bot.onText(/\/start/, (msg) => {
  const chatId = msg.chat.id;
  bot.sendMessage(chatId, "ðŸ­ *Ð•Ð²Ñ€Ð°Ð·Ð¸Ð¹ÑÐºÐ¸Ð¹ Ð›Ð¾Ð³Ð¸ÑÑ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ ÐŸÐ°Ñ€Ðº (ELP)*\n\nÐŸÑ€Ð¸Ð²ÐµÑ‚! Ð¯ Ð±Ð¾Ñ‚ ELP. Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð²Ð¾Ð¿Ñ€Ð¾Ñ Ð½Ð¸Ð¶Ðµ Ð¸Ð»Ð¸ Ð½Ð°Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ ÑÐ²Ð¾Ð¹:", {
    parse_mode: 'Markdown',
    reply_markup: createKeyboard()
  });
});

// ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹
bot.on('message', (msg) => {
  const chatId = msg.chat.id;
  const userText = msg.text.toLowerCase();
  
  if (userText.startsWith('/')) return;
  
  const responses = {
    'Ð¿Ð»Ð¾Ñ‰Ð°Ð´': knowledgeBase["Ð¿Ð»Ð¾Ñ‰Ð°Ð´ÑŒ"] + "\n\n" + knowledgeBase["ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ"],
    'ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚': knowledgeBase["ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ"],
    'Ñ€Ð°ÑÐ¿Ð¾Ð»Ð¾Ð¶ÐµÐ½': knowledgeBase["Ñ€Ð°ÑÐ¿Ð¾Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ"],
    'Ñ…Ð°Ñ€Ð°ÐºÑ‚ÐµÑ€Ð¸ÑÑ‚Ð¸Ðº': knowledgeBase["Ñ…Ð°Ñ€Ð°ÐºÑ‚ÐµÑ€Ð¸ÑÑ‚Ð¸ÐºÐ¸"],
    'Ð±Ñ€Ð¾ÐºÐµÑ€': knowledgeBase["Ð±Ñ€Ð¾ÐºÐµÑ€"],
    'ÑÑ€Ð¾Ðº': knowledgeBase["ÑÑ€Ð¾Ðº"],
    'Ð¸Ð½Ñ„Ñ€Ð°ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€': knowledgeBase["Ð¸Ð½Ñ„Ñ€Ð°ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð°"],
    'Ð´ÐµÐ²ÐµÐ»Ð¾Ð¿ÐµÑ€': knowledgeBase["Ð´ÐµÐ²ÐµÐ»Ð¾Ð¿ÐµÑ€"],
    'elp': "ðŸ­ Ð•Ð²Ñ€Ð°Ð·Ð¸Ð¹ÑÐºÐ¸Ð¹ Ð›Ð¾Ð³Ð¸ÑÑ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ ÐŸÐ°Ñ€Ðº â€” ÐºÐ»ÑŽÑ‡ÐµÐ²Ð¾Ð¹ Ñ…Ð°Ð± Ð² ÐÐ»Ð¼Ð°Ñ‚Ñ‹"
  };
  
  let response = "Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð²Ð¾Ð¿Ñ€Ð¾Ñ Ð¸Ð· Ð¼ÐµÐ½ÑŽ Ð¸Ð»Ð¸ Ð½Ð°Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ: Ð¿Ð»Ð¾Ñ‰Ð°Ð´ÑŒ, ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ, Ñ€Ð°ÑÐ¿Ð¾Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð¸ Ñ‚.Ð´.";
  
  for (const [key, answer] of Object.entries(responses)) {
    if (userText.includes(key)) {
      response = answer;
      break;
    }
  }
  
  bot.sendMessage(chatId, response, {reply_markup: createKeyboard()});
});

// Ð’ÐµÐ±-ÑÐµÑ€Ð²ÐµÑ€ Ð´Ð»Ñ Render
const PORT = process.env.PORT || 3000;
app.get('/', (req, res) => {
  res.send('âœ… Ð‘Ð¾Ñ‚ ELP Ð°ÐºÑ‚Ð¸Ð²ÐµÐ½!');
});
app.listen(PORT, () => console.log(`âœ… Ð¡ÐµÑ€Ð²ÐµÑ€ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½ Ð½Ð° Ð¿Ð¾Ñ€Ñ‚Ñƒ ${PORT}`));
